#set_bbc_worshipper_effect
#bbc_worshipper_whoring_around
#bbc_worshipper_service_fee
#bbc_worshipper_pay_gold
#bbc_worshipper_pay_piety
#bbc_worshipper_pay_prestige
#bbc_priestess_convert_vassal
#bbc_priestess_convert_county
#bbc_priestess_convert_neighboring_ruler
#bbc_priestess_convert_neighboring_county

set_bbc_worshipper_effect = {
    $BBC_WORSHIPPER$ = {
        if = {
            limit = { NOT = { liege = $EMPLOYER$ } }
            $EMPLOYER$ = { add_courtier = $BBC_WORSHIPPER$ }
        }
    }
    $EMPLOYER$ = {
        #Replace old bbc whore if exist
        if = {
            limit = {
                employs_court_position = bno_bbc_worshipper_court_position
                any_court_position_holder = {
                    type = bno_bbc_worshipper_court_position
                    count > 2
                }
            }
            every_court_position_holder = {
                type = bno_bbc_worshipper_court_position
                add_to_list = bbc_worshippers
            }
            ordered_in_list = {
                list = bbc_worshippers
                order_by = age

                save_scope_as = old_bbc_worshipper
            }
            $EMPLOYER$ = {
                replace_court_position = {
                    recipient = $BBC_WORSHIPPER$
                    holder = scope:old_bbc_worshipper
                    court_position = bno_bbc_worshipper_court_position
                }
                reverse_add_opinion = {
                    target = scope:old_bbc_worshipper
                    modifier = disappointed_opinion
					opinion = -15
                }
                reverse_add_opinion = {
                    target = $BBC_WORSHIPPER$
                    modifier = hired_me_opinion
                }
            }
        }
        else_if = {
            limit = {
                any_court_position_holder = {
                    type = bno_bbc_worshipper_court_position
                    count < 3
                }
            }
            appoint_court_position = {
                recipient = $BBC_WORSHIPPER$
                court_position = bno_bbc_worshipper_court_position
            }
            reverse_add_opinion = {
                target = $BBC_WORSHIPPER$
                modifier = hired_me_opinion
            }
        }
    }
}

bbc_worshipper_whoring_around = {
    every_character_to_title_neighboring_county = {
        holder ?= {
            add_to_list = bbc_worshipper_target
        }
    }
    liege ?= {
        every_courtier_or_guest = {
            limit = { is_rich_ai_blackbull = yes }
            add_to_list = bbc_worshipper_target
        }
        every_vassal_or_below = {
            limit = { is_rich_ai_blackbull = yes }
            add_to_list = bbc_worshipper_target
        }
        every_vassal_or_below = {
            limit = { highest_held_title_tier >= tier_county }
            every_courtier_or_guest = {
                limit = { is_rich_ai_blackbull = yes }
                add_to_list = bbc_worshipper_target
            }
        }
    }
    if = {
        limit = {
            list_size = {
                name = bbc_worshipper_target
                value > 0
            }
        }
        ordered_in_list = {
            list = bbc_worshipper_target
            order_by = gold
            save_scope_as = rich_bbc
        }
        bbc_worshipper_service_fee = {
            PAYEE = scope:rich_bbc
        }
        bno_have_sex_with_effects = {
            PARTNER = scope:rich_bbc
        }
    }
}

bbc_worshipper_service_fee = {
    bbc_worshipper_pay_gold = {
        PAYEE = $PAYEE$
    }
    bbc_worshipper_pay_piety = {
        PAYEE = $PAYEE$
    }
    bbc_worshipper_pay_prestige = {
        PAYEE = $PAYEE$
    }
}

bbc_worshipper_pay_gold = {
    $PAYEE$ = {
        if = {
            limit = { gold > 0 }
            pay_short_term_gold = {
                target = root
                gold  = minor_gold_value
            }
        }
    }
}

bbc_worshipper_pay_piety = {
    $PAYEE$ = {
        if = {
            limit = { piety > 0 }
            add_piety = minor_piety_loss
            root = { add_piety = minor_piety_gain }
        }
    }
    if = {
        limit = { faith = { has_doctrine = doctrine_adultery_women_crime } }
        add_piety = {
            value = minor_piety_gain
            add = { 5 10 }
            add = { 1 5 }
        }
    }
}

bbc_worshipper_pay_prestige = {
    $PAYEE$ = {
        if = {
            limit = { prestige > 0 }
            add_prestige = minor_prestige_loss
            root = { add_piety = minor_prestige_gain }
        }
    }
}

bbc_worshipper_give_all_spoil_to_liege = {
    save_scope_as = bbc_worshipper
    liege ?= {
        save_scope_as = TARGET_CHARACTER
    }
    if = {
        limit = { gold > 1 }
        pay_short_term_gold = {
            target = liege
            gold = this.gold
        }
    }
    if = {
        limit = { piety > 1 }
        liege ?= {
            add_piety = bbc_whore_piety
        }
        add_piety = {
            value = bbc_whore_piety
            multiply = -1
        }
    }
    if = {
        limit = { prestige > 1 }
        liege ?= {
            add_prestige = root.prestige
        }
        add_prestige = {
            value = root.prestige
            multiply = -1
        }
    }
}

bbc_priestess_convert_vassal = {
    if = {
        limit = {
            scope:liege = {
                any_vassal_or_below = {
                    highest_held_title_tier >= tier_county
                    NOT = { is_faith_bbcs = yes }
                }
            }
        }
        random_vassal_or_below = {
            limit = {
                NOT = { is_faith_bbcs = yes }
            }
            save_scope_as = target_vassal
        }
        scope:target_vassal = {
            random_list = {
                20 = {
                    set_character_faith_with_conversion = scope:liege.faith
                    scope:liege = {
                        send_interface_message = {
                            type = bno_blacked_events
                            title = bbc_priestess.1001.vassal_converted.title
                            right_icon = scope:employee
                            left_icon = scope:target_vassal
                            desc = bbc_priestess.1001.vassal_converted.desc
                        }
                    }
                }
                80 = {}
            }
        }
    }
}

bbc_priestess_convert_county = {
    if = {
        limit = {
            scope:liege = {
                any_sub_realm_county = {
                    NOT = { is_faith_bbcs = yes }
                }
            }
        }
        #scope here is landed title
        scope:liege = {
            random_sub_realm_county = {
                limit = {
                    NOT = { is_faith_bbcs = yes }
                }
                save_scope_as = target_landed_title
            }
        }
        scope:target_landed_title = {
            county = {
                random_list = {
                    20 = {
                        set_county_faith = scope:liege.faith
                        scope:liege = {
                            send_interface_message = {
                                type = bno_blacked_events
                                title = bbc_priestess.1001.county_converted.title
                                right_icon = scope:employee
                                left_icon = scope:target_landed_title
                                desc = bbc_priestess.1001.county_converted.desc
                            }
                        }
                    }
                    80 = {}
                }
            }
        }
    }
}

bbc_priestess_convert_neighboring_ruler = {
    if = {
        limit = {
            scope:liege = {
                any_character_to_title_neighboring_county = {
                    NOT = { is_faith_bbcs = yes }
                    holder = { NOT = { is_faith_bbcs = yes } }
                }
            }
        }
        scope:liege = {
            random_character_to_title_neighboring_county = {
                limit = {
                    NOT = { is_faith_bbcs = yes }
                    holder = { NOT = { is_faith_bbcs = yes } }
                }
                save_scope_as = target_neighboring_landed_title
            }
        }
        scope:target_neighboring_landed_title = {
            holder = {
                save_scope_as = neighboring_lord_or_lady
                random_list = {
                    20 = {
                        set_character_faith_with_conversion = scope:liege.faith
                        scope:liege = {
                            send_interface_message = {
                                type = bno_blacked_events
                                title = bbc_priestess.1001.neighboring_lord_converted.title
                                right_icon = scope:employee
                                left_icon = scope:neighboring_lord_or_lady
                                desc = bbc_priestess.1001.neighboring_lord_converted.desc
                            }
                        }
                    }
                    80 = {}
                }
            }
        }
    }
}

bbc_priestess_convert_neighboring_county = {
    if = {
        limit = {
            scope:liege = {
                any_character_to_title_neighboring_county = {
                    NOT = { is_faith_bbcs = yes }
                }
            }
        }
        scope:liege = {
            random_character_to_title_neighboring_county = {
                limit = {
                    NOT = { is_faith_bbcs = yes }
                }
                save_scope_as = target_neighboring_landed_title
            }
        }
        scope:target_neighboring_landed_title = {
            county = {
                random_list = {
                    20 = {
                        set_county_faith = scope:liege.faith
                        scope:liege = {
                            send_interface_message = {
                                type = bno_blacked_events
                                title = bbc_priestess.1001.neighboring_county_converted.title
                                right_icon = scope:employee
                                left_icon = scope:target_neighboring_landed_title
                                desc = bbc_priestess.1001.neighboring_county_converted.desc
                            }
                        }
                    }
                    80 = {}
                }
            }
        }
    }
}